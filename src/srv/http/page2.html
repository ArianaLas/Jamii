<html>
<head>
	<link rel="stylesheet" href="css/style-app.css" type="text/css" />
<!--	<script src="http://simplewebrtc.com/latest.js"></script>-->
	<!-- for derver on localhost -->
	 <script src="js/latest.js"></script> 
	<script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="js/friendList.js"></script>
	<script type="text/javascript" src="js/friendListGUI.js"></script>
	<script type="text/javascript" src="js/connectionManager.js"></script>
	<script type="text/javascript" src="js/initFunctions.js"></script>
	<script type="text/javascript">

function micro(){
	var x = document.getElementById("microphone").checked;
	if(x){
		alert("OK");
	}
	else{
		alert("BAD");

	}

}
function allowDrop(ev)
{
ev.preventDefault();
}

function drop(ev)
{
ev.preventDefault();
var data=ev.dataTransfer.getData("Text");
ev.target.appendChild(document.getElementById(data));
}




function onResize()
{
var w=document.getElementById('lWindow').offsetWidth;
var h=document.getElementById('lWindow').offsetHeight;


document.getElementById("localVideo").style.height=h;
}



function send(){

	var temp = document.getElementById("chat_input").value;	
	var data  = {};

    data ["login"] = window.my_user_object.login;
    data ["message"] = temp;

    window.connection.send("chat", data);
    console.log("aAAAA");
    



	document.getElementById("chat_input").value="";  

	var textList = document.getElementById("textList");
	textList.scrollTop = textList.scrollHeight;
	     
	return false;
}

   function runScript(e) {
    if (e.keyCode == 13) {
		send();					
    }
}


function clickDiv(){
	var something = document.getElementById('me');

	something.style.cursor = 'pointer';
	something.onclick = function() {
		document.getElementById("lWindow").innerHTML = document.getElementById('me');
	};
}

function clickView() {
	var views = document.getElementById("dBar").getElementsByTagName("div");

	for (i in views) {
		views[i].style.cursor = 'pointer';
		views[i].onclick = function() {
			document.getElementById("chat").style.visibility = "hidden";
			document.getElementById("friendList").style.visibility = "hidden";
			document.getElementById("options").style.visibility = "hidden";
			document.getElementById(this.className).style.visibility = "visible";
		};
	}
}

 window.onload = function() {
    initMainScreen();
    window.connection = new ConnectionManager("http://localhost","9393");

    window.connection.registerHandler("chatOK", function(data){
    		var list = document.getElementById("textList");
	var entry = document.createElement('li');
   		console.log("BBB");
     console.log( "got messae from: " + data.login + " : " + data.message );
		entry.appendChild(document.createTextNode(data.message));
		list.appendChild(entry);

    });



	clickDiv();
	clickView();


	var micro = document.getElementById("microphone");	


    document.getElementById("send").onclick = function() {
    	send();
    }
}

/*SimpleWebRTC*/
var webrtc = new SimpleWebRTC({
	localVideoEl: 'localVideo',
	remoteVideosEl: 'remoteVideos',
	autoRequestMedia: true
});

webrtc.on('readyToCall', function () {
	webrtc.joinRoom('My room name');
});
  </script>
</head>
<body onresize="onResize()">

	<!-- UPPER BAR -->
	<div id="uBar">
		<div id="user1"  ondrop="drop(event)" ondragover="allowDrop(event)">		
			<div id="remoteVideos"></div>
		</div>
		<div id="user2"  ondrop="drop(event)" ondragover="allowDrop(event)">
		</div>
		<div id="user3"  ondrop="drop(event)" ondragover="allowDrop(event)">
		</div>
		<div id="user4"  ondrop="drop(event)" ondragover="allowDrop(event)">
		</div>
		<div id="user5"  ondrop="drop(event)" ondragover="allowDrop(event)">
		</div>
		<div id="me">		
		</div>
		<h2>Jamii</h2>
	</div>

	<div id="content">
	<!-- MAIN VIEW -->
		<div id="lWindow">
			<video id="localVideo"></video>

		</div>

		<div id="friendList" class="rWindow">
		</div>
		<div id="options" class="rWindow">
	<input type = "checkbox" id = "microphone" value = "Microphone" onchange="micro()"/>Microphone</div>
	<!-- CHAT -->
		<div id="chat" class="rWindow">
			<ul id="textList">
			</ul>
			<input id="chat_input" type="text" name="chat_input" onkeypress="runScript(event)" />
			<input id="send" class="send_button" type="button" value="Send" />
		</div>

	</div>

	<!-- DOWN BAR -->
	<div id="dBar">
		<div class="chat">Chat
		</div><div class="friendList">Friends List
		</div><div class="board">Board
		</div><div class="fileShare">File Share
		</div><div class="desktopShare">Desktop Share
		</div><div class="options">Options</div>
	</div>
</body>
</html>
